pipeline{

    agent any

    environment {
        // Define environment variables
        SONAR_HOME = tool name: "SonarQubeInvoice"
    }
    
        environment {
        NVD_API_KEY = credentials('nvd-api-key')
    }

    stages{
        stage("start") {
            steps {
                echo "start pipeline"
            }
        }

        stage("Checkout Code from Github"){
            steps{
                echo "Code Cloning "
                git url: "https://github.com/Psonare56/Invoice-Generator.git",branch: "Devops"
            }
        }
        
        stage("SonarQube Quality Analysis") {
            steps {
                script {
                    // Run SonarQube analysis
                    withSonarQubeEnv('SonarQubeInvoice') {
                        sh "$SONAR_HOME/bin/sonar-scanner -Dsonar.projectName=Invoice-Generator -Dsonar.projectKey=Invoice-Generator"
                    }
                }
            }
        }
        
        stage("OWASP Dependency Check ") {
            steps {
               dependencyCheck additionalArguments: '--scan ./', nvdCredentialsId: 'nvd-api-key', odcInstallation: 'OWASPdcInvoice'
                dependencyCheckPublisher pattern: '**/dependency-check-report.xml'
            }
        }

        stage("End of code"){
            steps{
                echo "end of Code "
            }
        }
    }
}